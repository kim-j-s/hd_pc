
{{#> layout/guide }}

<style>
	.progress_bar + .progress_bar {
		margin-top: var(--gap-6);
	}
</style>

<div class="guide_h1">Progress</div>
<div class="guide_h4">횟수</div>

<div class="progress_bar progress_bar_ty1 progress_bar_ty1_count" role="img" tabindex="0">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp dp_ic1" data-pbc="3">
					<span class="text">3회</span>
				</span>
			</div>
		</div>
	</div>
	<div class="progress_bar_bottom">
		<span class="pbb_start" data-pbcs="0">0회</span>
		<span class="pbb_end" data-pbce="180">180회</span>
	</div>
</div>

<div class="progress_bar progress_bar_ty1 progress_bar_ty1_count" role="img" tabindex="0">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp dp_ic1" data-pbc="63">
					<span class="text">63회</span>
				</span>
			</div>
		</div>
	</div>
	<div class="progress_bar_bottom">
		<span class="pbb_start" data-pbcs="0">0회</span>
		<span class="pbb_end" data-pbce="180">180회</span>
	</div>
</div>

<div class="progress_bar progress_bar_ty1 progress_bar_ty1_count" role="img" tabindex="0">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp dp_ic1" data-pbc="165">
					<span class="text">165회</span>
				</span>
			</div>
		</div>
	</div>
	<div class="progress_bar_bottom">
		<span class="pbb_start" data-pbcs="0">0회</span>
		<span class="pbb_end" data-pbce="180">180회</span>
	</div>
</div>


<div class="guide_h4">날짜</div>
<div class="progress_bar progress_bar_ty1 progress_bar_ty1_date" role="img" tabindex="0">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp dp_ic2">
					<span class="text"></span>
				</span>
			</div>
		</div>
	</div>
	<div class="progress_bar_bottom">
		<span class="pbb_start" data-pbcsdate="2025.04.30">2025.04.30</span>
		<span class="pbb_end" data-pbcedate="2026.01.12">2026.01.12</span>
	</div>
</div>

<div class="progress_bar progress_bar_ty1 progress_bar_ty1_date" role="img" tabindex="0">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp dp_ic2">
					<span class="text"></span>
				</span>
			</div>
		</div>
	</div>
	<div class="progress_bar_bottom">
		<span class="pbb_start" data-pbcsdate="2024.01.13">2024.01.13</span>
		<span class="pbb_end" data-pbcedate="2028.01.12">2028.01.12</span>
	</div>
</div>

<div class="progress_bar progress_bar_ty1 progress_bar_ty1_date" role="img" tabindex="0">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp dp_ic2">
					<span class="text"></span>
				</span>
			</div>
		</div>
	</div>
	<div class="progress_bar_bottom">
		<span class="pbb_start" data-pbcsdate="2024.01.13">2024.01.13</span>
		<span class="pbb_end" data-pbcedate="2025.04.30">2025.04.30</span>
	</div>	
</div>

<div class="guide_h4">.progress_bar_ty2</div>
<div class="progress_bar_ty2" role="img" tabindex="0" aria-label="보장수준 보통">
	<div class="progress_bar_per_cover">
		<div class="progress_bar_per">
			<div class="per_bar">
				<span class="per_bar_dp" style="width:80%;"></span>
			</div>
		</div>
	</div>	
</div>
<br>
<div class="guide_discription">자동차보험 적용 Case (MPRMTPS10004030101 참조)</div>
<ul class="compare_rank_list">
	<li>
		<div class="info_rank">
			<span class="hd_badge outline solid_pastel c_primary size_m">1위</span>
			<span class="desc">2억원</span>
		</div>
		<div class="info_bar">
			<div class="progress_bar_ty2" role="img" tabindex="0" aria-label="진행률">
				<div class="progress_bar_per_cover">
					<div class="progress_bar_per">
						<div class="per_bar">
							<span class="per_bar_dp dp_ic2" style="width:80%;"></span>
						</div>
					</div>
				</div>	
			</div>
			<div class="percent">
				<span class="hd_badge solid_pastel c_tertiary size_m">80%</span>
			</div>
		</div>
	</li>
	<li>
		<div class="info_rank">
			<span class="hd_badge outline solid_pastel c_secondary size_m">2위</span>
			<span class="desc">5억원</span>
		</div>
		<div class="info_bar">
			<div class="progress_bar_ty2" role="img" tabindex="0" aria-label="진행률">
				<div class="progress_bar_per_cover">
					<div class="progress_bar_per">
						<div class="per_bar">
							<span class="per_bar_dp dp_ic2" style="width:16%;"></span>
						</div>
					</div>
				</div>	
			</div>
			<div class="percent">
				<span class="hd_badge solid_pastel c_tertiary size_m">16%</span>
			</div>
		</div>
	</li>
	<li>
		<div class="info_rank">
			<span class="hd_badge outline solid_pastel c_success size_m">3위</span>
			<span class="desc">미가입</span>
		</div>
		<div class="info_bar">
			<div class="progress_bar_ty2" role="img" tabindex="0" aria-label="진행률">
				<div class="progress_bar_per_cover">
					<div class="progress_bar_per">
						<div class="per_bar">
							<span class="per_bar_dp dp_ic2" style="width:64%;"></span>
						</div>
					</div>
				</div>	
			</div>
			<div class="percent">
				<span class="hd_badge solid_pastel c_tertiary size_m">64%</span>
			</div>
		</div>
	</li>
</ul>

<div class="guide_h4">.progress_bar_ty3</div>
<div class="progress_bar_ty3">
	<div class="progress_bar_per_cover">
		<!-- s: 필요한 보장에 맞는 aria-label값 적용필요 -->
		<div class="per_bar" role="img" tabindex="0" aria-label="대물배상 가입 통계">
		<!-- e: 필요한 보장에 맞는 aria-label값 적용필요 -->
			<span class="per_bar_dp dp_ty1" style="width:73%;"></span>
			<span class="per_bar_dp dp_ty2" style="width:27%;"></span>
		</div>
		<div class="progress_bar_bottom">
			<span class="pbb_left">5억 이상 가입률 <strong class="point">73%</strong></span>
			<span class="pbb_right">5억 미만 가입률 <strong>27%</strong></span>
		</div>
		<div class="progress_bar_title">&lt;2023년 현대해상 가입 통계&gt;</div>
	</div>
</div>
<div class="guide_h4">.progress_bar_ty4</div>
<div class="card_item_wrap">
	<!-- 부족 -->
	<div class="card_item">
		<div class="insu_plan">
			<!-- prettier-ignore -->
			<div class="tit">
				<span class="badge_wrap">
					<span class="hd_badge outline solid_pastel c_danger size_m">부족</span>
				</span>
				<span>뇌출혈진단</span>
			</div>
			<p>의사에 의해 뇌출혈로 진단이 확정된 경우 진단비 지급</p>
		</div>
		<div class="progress_bar_ty4" role="img" tabindex="0" aria-label="진행률">
			<div class="progress_bar_per_cover">
				<div class="progress_bar_per">
					<div class="per_bar">
						<span class="per_bar_dp" style="width:55%;"></span>
					</div>
				</div>
				<div class="text_item">
					<div>1,000만원 보장 중</div>
					<div>평균 1,800만원</div>
				</div>
			</div>	
		</div>
	</div>
	<!-- 미가입 -->
	<div class="card_item">
		<div class="insu_plan">
			<!-- prettier-ignore -->
			<div class="tit">
				<span class="badge_wrap">
					<span class="hd_badge outline solid_pastel c_info size_m">미가입</span>
				</span>
				<span>뇌졸중진단</span>
			</div>
			<p>의사에 의해 뇌졸중으로 진단이 확정된 경우 진단비 지급</p>
		</div>
		<div class="progress_bar_ty4" role="img" tabindex="0" aria-label="진행률">
			<div class="progress_bar_per_cover">
				<div class="progress_bar_per">
					<div class="per_bar">
						<span class="per_bar_dp" style="width:0%;"></span>
					</div>
				</div>
				<div class="text_item">
					<div>미가입</div>
					<div>평균 1,000만원</div>
				</div>
			</div>	
		</div>
	</div>
	<!-- 충분 -->
	<div class="card_item">
		<div class="insu_plan">
			<!-- prettier-ignore -->
			<div class="tit">
				<span class="badge_wrap">
					<span class="hd_badge outline solid_pastel c_secondary size_m">충분</span>
				</span>
				<span>뇌혈관질환진단</span>
			</div>
			<p>의사에 의해 뇌혈관 질환으로 진단이 확정된 경우 진단비 지급(뇌경색증, 뇌졸중, 뇌출혈, 대뇌/뇌전동맥의 폐쇄 및 협착 등)</p>
		</div>
		<div class="progress_bar_ty4 sufficient" role="img" tabindex="0" aria-label="진행률"><!-- 100%로 이상일때 sufficient 추가 -->
			<div class="progress_bar_per_cover">
				<div class="progress_bar_per">
					<div class="per_bar">
						<span class="per_bar_dp" style="width:100%;"></span>
					</div>
				</div>
				<div class="text_item">
					<div>1,000만원 보장 중</div>
					<div>평균 1,000만원</div>
				</div>
			</div>	
		</div>
	</div>
</div>
<div class="guide_h4">그 외 Case</div>
<div class="guide_discription">자동차보험 적용 Case (MPRMTPS10004030100 참조)</div>
<div class="coverage_level_box" role="img" aria-label="보장수준 보통">
	<ul class="level_list">
		<li class="level">
			<span><i></i></span>
		</li>
		<li class="level">
			<span><i></i></span>
		</li>
		<li class="level">
			<span><i></i></span>
		</li>
		<li class="level on">
			<span><i></i></span>
		</li>
		<li class="level">
			<span><i></i></span>
		</li>
	</ul>
</div>

<div class="guide_discription">자동차보험 적용 Case (MPRMTPS10002020100 참조)</div>
<div class="insurance_policyBox target">
	<div class="insurance_date">
		<div class="insurance_barbox">
			<!-- s: 진행영역 -->
			<!-- 
				접근성 준수를 위해서 해당 구간은 약식 정보를 전달합니다.
				전달정보는 aria-label="보험기간 365일" 형태로 제공됩니다.
				ex) <span id="plnInagDay">365일</span> 일 경우 aria-label="보험기간 365일"
				ex) <span id="plnInagDay">200일</span> 일 경우 aria-label="보험기간 200일"
			-->
			<div class="progress_box" role="img" aria-label="보험기간 365일">
				<span id="plnIng" class="ing">
					<span class="date" id="planCarTerm">
						<span id="plnInagDay">365일</span>
					</span>
					<i class="start left">시작일</i>
					<i class="end">종료일</i>
				</span>
			</div>
			<!-- e: 진행영역 -->
		</div>
	</div>
</div>

<div class="guide_discription">자동차보험 적용 Case2(기준일변경) (MMYMTEN10010030000 참조)</div>
<div class="insurance_policyBox">
	<div class="insurance_date">
		<div class="insurance_barbox ty2">
			<!-- s: 진행영역 -->
			<!-- 
				접근성 준수를 위해서 해당 구간은 약식 정보를 전달합니다.
				전달정보는 aria-label="변경기간 365일" 형태로 제공됩니다.
				ex) <span id="plnInagDay">200일</span> 일 경우 aria-label="변경기간 200일"
				변경기간 적용 시, prograssCar() 호출 필요
			-->
			<!-- 스크립트 부분은 MMYMTEN10002030000 페이지 참고 -->
			<div class="progress_box_ty2" role="img" aria-label="변경기간 220일">
				<i class="start">
					<span class="spot">시작일</span>
					<em></em>
				</i>
				<span id="plnIng" class="ing" style="width:100%">
					<span class="date" id="planCarTerm">
						<span id="plnInagDay">220일</span>
					</span>
					<i class="newStart">
						<span class="spot">기준일</span>
						<em></em>
					</i>
					<i class="end">
						<span class="spot">종료일</span>
						<em></em>
					</i>
				</span>
			</div>
			<!-- e: 진행영역 -->
		</div>
	</div>
</div>


<script>
	$(function(){		

	function updateProgressBarPosition($progressBar) {
			
		// 접근성 관련 문구 생성 후 삽입
		var current = $progressBar.find('[data-pbc]').data('pbc');
		var total = $progressBar.find('[data-pbce]').data('pbce');

		$progressBar.attr('aria-label', '전체 ' + total + '회 중 ' + current + '회 납입');
		
		// 전체 넓이
		var $progressBarPer = $progressBar.find('.progress_bar_per');
		var progressBarPerWidth = $progressBarPer.outerWidth(); // 기준 넓이(px)

		// 퍼센트 계산 (소수점 없이)
		var percent = Math.floor((current / total) * 100);       // 현재 진행률(%)

		var pixelWidth = Math.floor((percent / 100) * progressBarPerWidth);  // 진행률 px 환산

		var $perBar = $progressBar.find('.per_bar');
		var $perBarDp = $perBar.find('.per_bar_dp');
		var perBarDpWidth = $perBarDp.outerWidth();

		// console.log('움직이는 컨텐츠 넓이 : ', perBarDpWidth);

		// 초기 클래스 제거
		$perBar.removeClass('pos');
		$perBarDp.removeClass('poe');

		// 앞에 고정하기
		if (pixelWidth < perBarDpWidth / 2) {
			$perBar.addClass('pos');
		} else {
			$perBar.removeClass('pos');
		}

		// 끝으로 보내기
		if (progressBarPerWidth - pixelWidth < perBarDpWidth / 2) {
			$perBar.addClass('poe');
		} else {
			$perBar.removeClass('poe');
		}

		// per_bar 너비 설정
		setTimeout(function(){
			$perBar.addClass('active').css('width', percent + '%');
		}, 100);
	}

	// 여러 개의 .progress_bar_ty1_count 대해 반복 처리
	$('.progress_bar_ty1_count').each(function() {
		var $this = $(this); // 각 progress_bar_ty1을 $this로 참조
		
		// 윈도우 로드 시 updateProgressBarPosition 함수 호출
		$(window).on('load', function () {
			updateProgressBarPosition($this);
		});

		// 리사이즈 시에도 적용
		$(window).on('resize', function () {
			console.log('리사이즈 됨?');
			updateProgressBarPosition($this);
		});
	});


	function updateProgressBarWithDate() {

		// progress_bar_ty1에 대해 각 요소 선택
		$('.progress_bar_ty1_date').each(function() {
			var $progressBar = $(this);

			// 시작일과 종료일을 data 속성으로부터 가져오기
			var startDate = $progressBar.find('[data-pbcsdate]').data('pbcsdate');
			var endDate = $progressBar.find('[data-pbcedate]').data('pbcedate');

			

			// 날짜 형식: 'YYYY.MM.DD' → Date 객체로 변환
			var start = new Date(startDate.replace(/\./g, '/'));
			var end = new Date(endDate.replace(/\./g, '/'));
			var now = new Date();  // 현재 날짜

			// 전체 기간 계산 (밀리초 단위)
			var totalTime = end - start;
			// 현재 진행 시간 계산 (밀리초 단위)
			var currentTime = now - start;

			// 진행률 계산 (소수점 없이)
			var percent = Math.floor((currentTime / totalTime) * 100);

			// D-XX 형식으로 남은 일수 계산
			var remainingDays = Math.ceil((end - now) / (1000 * 60 * 60 * 24));

			// 'D-XX' 형식으로 .text에 삽입
			$progressBar.find('.per_bar_dp .text').text('D-' + remainingDays);

			// 접근성 관련 문구 생성 후 삽입
			$progressBar.attr('aria-label', '만기일 (' + endDate + ') 만기 ' + remainingDays + '일 전');

			// 전체 넓이
			var $progressBarPer = $progressBar.find('.progress_bar_per');
			var progressBarPerWidth = $progressBarPer.outerWidth(); // 기준 넓이(px)

			// 진행률을 px로 환산
			var pixelWidth = Math.floor((percent / 100) * progressBarPerWidth);

			var $perBar = $progressBar.find('.per_bar');
			var $perBarDp = $perBar.find('.per_bar_dp');
			var perBarDpWidth = $perBarDp.outerWidth();

			// 초기 클래스 제거
			$perBar.removeClass('pos');
			$perBarDp.removeClass('poe');

			// 앞에 고정하기
			if(pixelWidth < perBarDpWidth / 2) {
					console.log('앞에 처박기');
					$perBar.addClass('pos');
			}

			// 끝으로 보내기
			if(progressBarPerWidth - pixelWidth < perBarDpWidth / 2) {
					console.log('끝으로 보내기');
					$perBar.addClass('poe');
			}

			// 진행률에 따른 per_bar 너비 설정
			setTimeout(function(){
					$perBar.addClass('active').css('width', percent + '%');
			}, 100);
		});
		}

		$(window).on('load', function () {
		updateProgressBarWithDate();
		});

		// 리사이즈 시에도 적용
		$(window).on('resize', function () {
		updateProgressBarWithDate();
		});

});

</script>


{{/ layout/guide }}